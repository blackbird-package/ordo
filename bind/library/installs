#!/bin/bash

# system main package
MAINPACK=()

# system aurs package
AURSPACK=()

# system core package
COREPACK=()

# system flatpack package
FLATPACK=()


function blackbird_regpack_main() {
    MAINPACK+=($1)
}


function blackbird_regpack_aurs() {
    AURSPACK+=($1)
}


function blackbird_regpack_core() {
    COREPACK+=($1)
}


function blackbird_regpack_flat() {
    FLATPACK+=($1)
}


##
## CHROOT WRAP

function userc() {
    arch-chroot /mnt /bin/bash -c 'sudo -H -u installman /bin/bash -c "'$1'"' 
}


function rootc() {
    arch-chroot /mnt /bin/bash -c $1
}



## 
## INSTALLATION MODULE

function blackbird_package_install_module_yays() {
    userc "git clone https://aur.archlinux.org/yay /tmp/yay"
    userc "makepkg -sric --dir /tmp/yay --noconfirm"
}


function blackbird_package_install_module_aurs() {
    
    echo ""
    echo ${AURSPACK[*]}
}


function blackbird_package_install_module_core() {


    for coreapp in "${COREPACK[@]}"; do
        rootc "git clone https://aur.archlinux.org/$coreapp /tmp/"
        rootc "/bin/bash /tmp/$coreapp/make"
    done
}


function blackbird_package_install_module_flat() {
   
    for flatapp in "${FLATPACK[@]}"; do

        

    done
}


## 
## MAIN FUNCTIONS

function blackbird_package_install_init() {

    blackbird_scope_init "Install Base Packages"
    pacstrap /mnt ${MAINPACK[*]} --noconfirm
    blackbird_scope_done
    sleep 5
}


function blackbird_package_install_aurs() {

    blackbird_scope_init "Install Community Packages"
    blackbird_package_install_module_yays
    blackbird_package_install_module_aurs
    blackbird_scope_done    
}



function blackbird_package_install_core() {
    blackbird_scope_init "Install Core Packages"
    blackbird_package_install_module_core
    blackbird_scope_done
}


function blackbird_package_install_flat() {
    blackbird_scope_init "Install Flatpak Packages"
    blackbird_package_install_module_flat
    blackbird_scope_done
}